<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.metavirtual.bloom.user.model.dao.UserMapper">

    <resultMap id="userResultMap" type="com.metavirtual.bloom.user.model.dto.UserDTO">
        <id property="userId" column="USER_ID"/>
        <result property="name" column="NAME"/>
        <result property="gender" column="GENDER"/>
        <result property="pwd" column="PASSWORD"/>
        <result property="email" column="EMAIL"/>
        <result property="phone" column="PHONE"/>
        <result property="registDate" column="REGISTDATE"/>
        <result property="authorityCode" column="AUTHORITY_CODE"/>
    </resultMap>

    <resultMap id="memberResultMap" type="com.metavirtual.bloom.user.model.dto.MemberDTO">
        <id property="userId" column="USER_ID"/>
        <result property="etcContent" column="ETC_CONTENT"/>
        <result property="testStatus" column="TEST_STATUS"/>
        <result property="therapistGenderCK" column="THERAPIST_GENDER_CK"/>
        <result property="nickname" column="NICKNAME"/>
        <result property="reportCount" column="REPORT_COUNT"/>
        <result property="relationCK" column="RELATION_CK"/>
    </resultMap>

    <select id="idDupCheck" parameterType="String" resultType="int">
        SELECT COUNT(*)
        FROM USER U
        WHERE U.USER_ID = #{ userId }
    </select>

    <select id="nicknameDupCheck" parameterType="String" resultType="int">
        SELECT COUNT(*)
        FROM MEMBER M
        WHERE M.NICKNAME = #{ nickname }
    </select>

    <select id="selectUserById" parameterType="String" resultMap="userResultMap">
        SELECT U.USER_ID
                FROM USER U
                WHERE U.USER_ID = #{ userId }
    </select>


    <insert id="insertUser" parameterType="UserDTO">
        INSERT INTO
                    USER U (
                              NAME
                            , USER_ID
                            , GENDER
                            , PWD
                            , EMAIL
                            , PHONE
                            , REGISTDATE
                            )
                VALUES (
                          #{ name }
                        , #{ username }
                        , #{ gender }
                        , #{ password }
                        , #{ email }
                        , #{ phone }
                        , #{ registDate }
                        )
    </insert>

        <insert id="insertMember" parameterType="MemberDTO">
            INSERT INTO MEMBER (NICKNAME)
            SELECT M.NICKNAME
            FROM MEMBER M
            INNER JOIN USER U ON M.USER_ID = U.USER_ID;
        </insert>

</mapper>